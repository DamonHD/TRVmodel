<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (19) -->
<title>Source code</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="source: package: org.hd.d.TRVmodel.hg, class: ShowComputations">
<meta name="generator" content="javadoc/SourceToHTMLConverter">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
</head>
<body class="source-page">
<main role="main">
<div class="source-container">
<pre><span class="source-line-no">001</span><span id="line-1">package org.hd.d.TRVmodel.hg;</span>
<span class="source-line-no">002</span><span id="line-2"></span>
<span class="source-line-no">003</span><span id="line-3">import java.io.File;</span>
<span class="source-line-no">004</span><span id="line-4">import java.io.IOException;</span>
<span class="source-line-no">005</span><span id="line-5">import java.util.Date;</span>
<span class="source-line-no">006</span><span id="line-6"></span>
<span class="source-line-no">007</span><span id="line-7">import org.hd.d.TRVmodel.data.DDNTemperatureDataCSV;</span>
<span class="source-line-no">008</span><span id="line-8">import org.hd.d.TRVmodel.data.HourlyTemperatureDataDescriptor;</span>
<span class="source-line-no">009</span><span id="line-9">import org.hd.d.TRVmodel.hg.HGTRVHPMModelByHour.ScenarioResult;</span>
<span class="source-line-no">010</span><span id="line-10">import org.hd.d.TRVmodel.hg.HGTRVHPMModelParameterised.DemandWithoutAndWithSetback;</span>
<span class="source-line-no">011</span><span id="line-11">import org.hd.d.TRVmodel.hg.HGTRVHPMModelParameterised.ModelParameters;</span>
<span class="source-line-no">012</span><span id="line-12"></span>
<span class="source-line-no">013</span><span id="line-13">/**Show computations from the Heat Geek TRV/HP model. */</span>
<span class="source-line-no">014</span><span id="line-14">public final class ShowComputations</span>
<span class="source-line-no">015</span><span id="line-15">        {</span>
<span class="source-line-no">016</span><span id="line-16">        /**Prevent creation of an instance. */</span>
<span class="source-line-no">017</span><span id="line-17">    private ShowComputations() { }</span>
<span class="source-line-no">018</span><span id="line-18"></span>
<span class="source-line-no">019</span><span id="line-19">    /**Print key computations/results on stdout.</span>
<span class="source-line-no">020</span><span id="line-20">         * @throws IOException in case of missing or corrupt temperature data</span>
<span class="source-line-no">021</span><span id="line-21">     */</span>
<span class="source-line-no">022</span><span id="line-22">        public static void showCalcs() throws IOException</span>
<span class="source-line-no">023</span><span id="line-23">                {</span>
<span class="source-line-no">024</span><span id="line-24">                System.out.println("Show HG TRV/HP model computations.");</span>
<span class="source-line-no">025</span><span id="line-25">                System.out.println("Date/time: " + new Date());</span>
<span class="source-line-no">026</span><span id="line-26"></span>
<span class="source-line-no">027</span><span id="line-27">                System.out.println();</span>
<span class="source-line-no">028</span><span id="line-28">                System.out.println(String.format("Hardwired model, electricity demand normal / setback: %.0fW / %.0fW",</span>
<span class="source-line-no">029</span><span id="line-29">                        HGTRVHPMModel.HEAT_PUMP_POWER_IN_NO_SETBACK_W,</span>
<span class="source-line-no">030</span><span id="line-30">                        HGTRVHPMModel.HEAT_PUMP_POWER_IN_B_SETBACK_W));</span>
<span class="source-line-no">031</span><span id="line-31"></span>
<span class="source-line-no">032</span><span id="line-32">        final HGTRVHPMModelParameterised.ModelParameters defaultParams = new HGTRVHPMModelParameterised.ModelParameters();</span>
<span class="source-line-no">033</span><span id="line-33">                System.out.println(String.format("Parameterised model, all default parameters, electricity demand normal / setback: %.0fW / %.0fW",</span>
<span class="source-line-no">034</span><span id="line-34">            HGTRVHPMModelParameterised.computeBungalowHPElectricityDemandW(defaultParams, false),</span>
<span class="source-line-no">035</span><span id="line-35">            HGTRVHPMModelParameterised.computeBungalowHPElectricityDemandW(defaultParams, true)));</span>
<span class="source-line-no">036</span><span id="line-36"></span>
<span class="source-line-no">037</span><span id="line-37">                System.out.println(String.format("Parameterised model, fixes applied for doors and CoP temperature, electricity demand normal / setback: %.0fW / %.0fW",</span>
<span class="source-line-no">038</span><span id="line-38">            HGTRVHPMModelParameterised.computeBungalowHPElectricityDemandW(HGTRVHPMModelParameterised.ModelParameters.FIXES_APPLIED, false),</span>
<span class="source-line-no">039</span><span id="line-39">            HGTRVHPMModelParameterised.computeBungalowHPElectricityDemandW(HGTRVHPMModelParameterised.ModelParameters.FIXES_APPLIED, true)));</span>
<span class="source-line-no">040</span><span id="line-40"></span>
<span class="source-line-no">041</span><span id="line-41">                System.out.println(String.format("Parameterised model, fixes applied and AABB lower-loss arrangement, electricity demand normal / setback: %.0fW / %.0fW",</span>
<span class="source-line-no">042</span><span id="line-42">            HGTRVHPMModelParameterised.computeBungalowHPElectricityDemandW(HGTRVHPMModelParameterised.ModelParameters.FIXES_AND_AABB, false),</span>
<span class="source-line-no">043</span><span id="line-43">            HGTRVHPMModelParameterised.computeBungalowHPElectricityDemandW(HGTRVHPMModelParameterised.ModelParameters.FIXES_AND_AABB, true)));</span>
<span class="source-line-no">044</span><span id="line-44"></span>
<span class="source-line-no">045</span><span id="line-45"></span>
<span class="source-line-no">046</span><span id="line-46">        System.out.println();</span>
<span class="source-line-no">047</span><span id="line-47">        System.out.println("Parameterised model, fixes applied for doors and CoP temperature, external air temperature varied...");</span>
<span class="source-line-no">048</span><span id="line-48">        for(double eat = HGTRVHPMModel.EXTERNAL_AIR_TEMPERATURE_C - 10.0; eat &lt; HGTRVHPMModel.SETBACK_ROOM_TEMPERATURE_C; eat += 1.0)</span>
<span class="source-line-no">049</span><span id="line-49">                {</span>
<span class="source-line-no">050</span><span id="line-50">                final HGTRVHPMModelParameterised.ModelParameters params = new ModelParameters(</span>
<span class="source-line-no">051</span><span id="line-51">                                ModelParameters.FIXED_DOORS_PER_INTERNAL_WALL,</span>
<span class="source-line-no">052</span><span id="line-52">                                ModelParameters.FIXED_CORRECT_COP_FOR_FLOW_TEMPERATURE,</span>
<span class="source-line-no">053</span><span id="line-53">                                ModelParameters.DEFAULT_ARRANGEMENT_ABAB,</span>
<span class="source-line-no">054</span><span id="line-54">                                eat);</span>
<span class="source-line-no">055</span><span id="line-55">                if(Math.abs(HGTRVHPMModel.EXTERNAL_AIR_TEMPERATURE_C - eat) &lt; 0.1)</span>
<span class="source-line-no">056</span><span id="line-56">                        {</span>
<span class="source-line-no">057</span><span id="line-57">                        System.out.println(String.format(" *** original external air temperature, ie %.1fC", eat));</span>
<span class="source-line-no">058</span><span id="line-58">                        }</span>
<span class="source-line-no">059</span><span id="line-59">                System.out.println(String.format("  %s, electricity demand normal / setback: %.0fW / %.0fW",</span>
<span class="source-line-no">060</span><span id="line-60">                        params.toString(),</span>
<span class="source-line-no">061</span><span id="line-61">                    HGTRVHPMModelParameterised.computeBungalowHPElectricityDemandW(params, false),</span>
<span class="source-line-no">062</span><span id="line-62">                    HGTRVHPMModelParameterised.computeBungalowHPElectricityDemandW(params, true) ));</span>
<span class="source-line-no">063</span><span id="line-63">                }</span>
<span class="source-line-no">064</span><span id="line-64"></span>
<span class="source-line-no">065</span><span id="line-65"></span>
<span class="source-line-no">066</span><span id="line-66">        System.out.println("");</span>
<span class="source-line-no">067</span><span id="line-67">        System.out.println("Parameterised model, fixes applied for doors and CoP temperature, external air temperature varied...");</span>
<span class="source-line-no">068</span><span id="line-68">        System.out.println("London (EGLL) 2018 hourly temperatures");</span>
<span class="source-line-no">069</span><span id="line-69">        final DDNTemperatureDataCSV temperaturesLondon2018 =</span>
<span class="source-line-no">070</span><span id="line-70">                        DDNTemperatureDataCSV.loadDDNTemperatureDataCSV(DDNTemperatureDataCSV.DATA_EGLL_2018);</span>
<span class="source-line-no">071</span><span id="line-71">        final HGTRVHPMModelByHour scenarioLondon2018 = new HGTRVHPMModelByHour(</span>
<span class="source-line-no">072</span><span id="line-72">                        HGTRVHPMModelParameterised.ModelParameters.FIXES_APPLIED, temperaturesLondon2018);</span>
<span class="source-line-no">073</span><span id="line-73">        final ScenarioResult resultLondon2018 = scenarioLondon2018.runScenario(false, false, null);</span>
<span class="source-line-no">074</span><span id="line-74">        System.out.println(String.format("Percentage of hours that room setback raises heat pump demand: %.0f%%",</span>
<span class="source-line-no">075</span><span id="line-75">                        100 * resultLondon2018.hoursFractionSetbackRaisesDemand()));</span>
<span class="source-line-no">076</span><span id="line-76">        final double heatNoSetbackLondon2018 = resultLondon2018.demand().noSetback().heatDemand();</span>
<span class="source-line-no">077</span><span id="line-77">        final double heatWithSetbackLondon2018 = resultLondon2018.demand().withSetback().heatDemand();</span>
<span class="source-line-no">078</span><span id="line-78">        System.out.println(String.format("Heat mean demand: with no setback %.0fW, with setback %.0fW; %.0f%% change with setback",</span>
<span class="source-line-no">079</span><span id="line-79">                        heatNoSetbackLondon2018, heatWithSetbackLondon2018, 100*((heatWithSetbackLondon2018/heatNoSetbackLondon2018)-1)));</span>
<span class="source-line-no">080</span><span id="line-80">        final double powerNoSetbackLondon2018 = resultLondon2018.demand().noSetback().heatPumpElectricity();</span>
<span class="source-line-no">081</span><span id="line-81">        final double powerWithSetbackLondon2018 = resultLondon2018.demand().withSetback().heatPumpElectricity();</span>
<span class="source-line-no">082</span><span id="line-82">        System.out.println(String.format("Heat pump mean power: with no setback %.0fW, with setback %.0fW; %.0f%% change with setback",</span>
<span class="source-line-no">083</span><span id="line-83">                        powerNoSetbackLondon2018, powerWithSetbackLondon2018, 100*((powerWithSetbackLondon2018/powerNoSetbackLondon2018)-1)));</span>
<span class="source-line-no">084</span><span id="line-84"></span>
<span class="source-line-no">085</span><span id="line-85">        System.out.println("");</span>
<span class="source-line-no">086</span><span id="line-86">        System.out.println("Parameterised model, fixes applied for doors and CoP temperature, external air temperature varied...");</span>
<span class="source-line-no">087</span><span id="line-87">        System.out.println("Glasgow (EGPF) 2018 hourly temperatures");</span>
<span class="source-line-no">088</span><span id="line-88">        final DDNTemperatureDataCSV temperaturesGlasgow2018 =</span>
<span class="source-line-no">089</span><span id="line-89">                        DDNTemperatureDataCSV.loadDDNTemperatureDataCSV(DDNTemperatureDataCSV.DATA_EGPF_2018);</span>
<span class="source-line-no">090</span><span id="line-90">        final HGTRVHPMModelByHour scenarioGlasgow2018 = new HGTRVHPMModelByHour(</span>
<span class="source-line-no">091</span><span id="line-91">                        HGTRVHPMModelParameterised.ModelParameters.FIXES_APPLIED, temperaturesGlasgow2018);</span>
<span class="source-line-no">092</span><span id="line-92">        final ScenarioResult resultGlasgow2018 = scenarioGlasgow2018.runScenario(false, false, null);</span>
<span class="source-line-no">093</span><span id="line-93">        System.out.println(String.format("Percentage of hours that room setback raises heat pump demand: %.0f%%",</span>
<span class="source-line-no">094</span><span id="line-94">                        100 * resultGlasgow2018.hoursFractionSetbackRaisesDemand()));</span>
<span class="source-line-no">095</span><span id="line-95">        final double heatNoSetbackGlasgow2018 = resultGlasgow2018.demand().noSetback().heatDemand();</span>
<span class="source-line-no">096</span><span id="line-96">        final double heatWithSetbackGlasgow2018 = resultGlasgow2018.demand().withSetback().heatDemand();</span>
<span class="source-line-no">097</span><span id="line-97">        System.out.println(String.format("Heat mean demand: with no setback %.0fW, with setback %.0fW; %.0f%% change with setback",</span>
<span class="source-line-no">098</span><span id="line-98">                        heatNoSetbackGlasgow2018, heatWithSetbackGlasgow2018, 100*((heatWithSetbackGlasgow2018/heatNoSetbackGlasgow2018)-1)));</span>
<span class="source-line-no">099</span><span id="line-99">        final double powerNoSetbackGlasgow2018 = resultGlasgow2018.demand().noSetback().heatPumpElectricity();</span>
<span class="source-line-no">100</span><span id="line-100">        final double powerWithSetbackGlasgow2018 = resultGlasgow2018.demand().withSetback().heatPumpElectricity();</span>
<span class="source-line-no">101</span><span id="line-101">        System.out.println(String.format("Heat pump mean power: with no setback %.0fW, with setback %.0fW; %.0f%% change with setback",</span>
<span class="source-line-no">102</span><span id="line-102">                        powerNoSetbackGlasgow2018, powerWithSetbackGlasgow2018, 100*((powerWithSetbackGlasgow2018/powerNoSetbackGlasgow2018)-1)));</span>
<span class="source-line-no">103</span><span id="line-103"></span>
<span class="source-line-no">104</span><span id="line-104"></span>
<span class="source-line-no">105</span><span id="line-105">        // Bungalow vs detached, original conditions.</span>
<span class="source-line-no">106</span><span id="line-106">        System.out.println("");</span>
<span class="source-line-no">107</span><span id="line-107">        System.out.println("Bungalow (original) vs detached:");</span>
<span class="source-line-no">108</span><span id="line-108">                final DemandWithoutAndWithSetback bungalowDemandW = HGTRVHPMModelParameterised.computeBungalowDemandW(HGTRVHPMModelParameterised.ModelParameters.FIXES_APPLIED);</span>
<span class="source-line-no">109</span><span id="line-109">                System.out.println(String.format("Parameterised bungalow model, fixes applied for doors and CoP temperature, electricity demand normal / setback: %.0fW / %.0fW",</span>
<span class="source-line-no">110</span><span id="line-110">            bungalowDemandW.noSetback().heatPumpElectricity(),</span>
<span class="source-line-no">111</span><span id="line-111">            bungalowDemandW.withSetback().heatPumpElectricity()));</span>
<span class="source-line-no">112</span><span id="line-112">                final DemandWithoutAndWithSetback detachedDemandW = HGTRVHPMModelParameterised.computeDetachedDemandW(HGTRVHPMModelParameterised.ModelParameters.FIXES_APPLIED, false);</span>
<span class="source-line-no">113</span><span id="line-113">                System.out.println(String.format("Parameterised detached model, fixes applied for doors and CoP temperature, electricity demand normal / setback: %.0fW / %.0fW",</span>
<span class="source-line-no">114</span><span id="line-114">            detachedDemandW.noSetback().heatPumpElectricity(),</span>
<span class="source-line-no">115</span><span id="line-115">            detachedDemandW.withSetback().heatPumpElectricity()));</span>
<span class="source-line-no">116</span><span id="line-116"></span>
<span class="source-line-no">117</span><span id="line-117"></span>
<span class="source-line-no">118</span><span id="line-118">                // 7 major towns/cities x 10Y, bungalow and detached (ABAB and AABB as sensitivity measure).</span>
<span class="source-line-no">119</span><span id="line-119">        System.out.println("");</span>
<span class="source-line-no">120</span><span id="line-120">        System.out.println(String.format("7 towns/cites, 10Y hourly data (201x, %d hours), bungalow and detached, two room heating patterns:", DDNTemperatureDataCSV.RECORD_COUNT_201X_TEMPERATURE_DATA));</span>
<span class="source-line-no">121</span><span id="line-121">                for(final HourlyTemperatureDataDescriptor htdd : DDNTemperatureDataCSV.DESCRIPTORS_201X_DATASET)</span>
<span class="source-line-no">122</span><span id="line-122">                        {</span>
<span class="source-line-no">123</span><span id="line-123">                        System.out.println(String.format("%s (weather station at %s):", htdd.conurbation(), htdd.station()));</span>
<span class="source-line-no">124</span><span id="line-124">                // Load temperature data for this station.</span>
<span class="source-line-no">125</span><span id="line-125">                        final DDNTemperatureDataCSV temperatures201X =</span>
<span class="source-line-no">126</span><span id="line-126">                        DDNTemperatureDataCSV.loadDDNTemperatureDataCSV(new File(DDNTemperatureDataCSV.PATH_TO_201X_TEMPERATURE_DATA,</span>
<span class="source-line-no">127</span><span id="line-127">                                        htdd.station() + DDNTemperatureDataCSV.FILE_TAIL_FOR_201X_TEMPERATURE_FILE));</span>
<span class="source-line-no">128</span><span id="line-128">            if(DDNTemperatureDataCSV.RECORD_COUNT_201X_TEMPERATURE_DATA != temperatures201X.data().size())</span>
<span class="source-line-no">129</span><span id="line-129">                { throw new IOException("bad record count"); }</span>
<span class="source-line-no">130</span><span id="line-130">                        for(final boolean detached : new boolean[]{false, true})</span>
<span class="source-line-no">131</span><span id="line-131">                                {</span>
<span class="source-line-no">132</span><span id="line-132">                        final String archetype = detached ? "detached" : "bungalow";</span>
<span class="source-line-no">133</span><span id="line-133">                                System.out.println("  Archetype " + archetype);</span>
<span class="source-line-no">134</span><span id="line-134">                                for(final boolean abab : new boolean[]{true, false})</span>
<span class="source-line-no">135</span><span id="line-135">                                        {</span>
<span class="source-line-no">136</span><span id="line-136">                                final String layout = abab ? "ABAB" : "AABB";</span>
<span class="source-line-no">137</span><span id="line-137">                                        System.out.println("    Layout " + layout);</span>
<span class="source-line-no">138</span><span id="line-138">                                final HGTRVHPMModelParameterised.ModelParameters modelParameters = new HGTRVHPMModelParameterised.ModelParameters(</span>
<span class="source-line-no">139</span><span id="line-139">                                                        ModelParameters.FIXED_DOORS_PER_INTERNAL_WALL,</span>
<span class="source-line-no">140</span><span id="line-140">                                                        ModelParameters.FIXED_CORRECT_COP_FOR_FLOW_TEMPERATURE,</span>
<span class="source-line-no">141</span><span id="line-141">                                                        abab,</span>
<span class="source-line-no">142</span><span id="line-142">                                                        ModelParameters.DEFAULT_EXTERNAL_AIR_TEMPERATURE_C);</span>
<span class="source-line-no">143</span><span id="line-143">                                        final HGTRVHPMModelByHour scenario201X = new HGTRVHPMModelByHour(</span>
<span class="source-line-no">144</span><span id="line-144">                                        modelParameters,</span>
<span class="source-line-no">145</span><span id="line-145">                                        temperatures201X);</span>
<span class="source-line-no">146</span><span id="line-146">                                System.out.println("      Scenario base model parameters: " + modelParameters);</span>
<span class="source-line-no">147</span><span id="line-147">                                final ScenarioResult result201X = scenario201X.runScenario(detached, false, null);</span>
<span class="source-line-no">148</span><span id="line-148">                                final double heatNoSetback201X = result201X.demand().noSetback().heatDemand();</span>
<span class="source-line-no">149</span><span id="line-149">                                final double heatWithSetback201X = result201X.demand().withSetback().heatDemand();</span>
<span class="source-line-no">150</span><span id="line-150">                                System.out.println(String.format("      Heat mean demand: with no setback %.0fW, with setback %.0fW; %.0f%% change with setback",</span>
<span class="source-line-no">151</span><span id="line-151">                                                heatNoSetback201X, heatWithSetback201X, 100*((heatWithSetback201X/heatNoSetback201X)-1)));</span>
<span class="source-line-no">152</span><span id="line-152">                                final double powerNoSetback201X = result201X.demand().noSetback().heatPumpElectricity();</span>
<span class="source-line-no">153</span><span id="line-153">                                final double powerWithSetback201X = result201X.demand().withSetback().heatPumpElectricity();</span>
<span class="source-line-no">154</span><span id="line-154">                                System.out.println(String.format("      Heat pump mean power: with no setback %.0fW, with setback %.0fW; %.0f%% change with setback",</span>
<span class="source-line-no">155</span><span id="line-155">                                                powerNoSetback201X, powerWithSetback201X, 100*((powerWithSetback201X/powerNoSetback201X)-1)));</span>
<span class="source-line-no">156</span><span id="line-156">                                System.out.println(String.format("      Percentage of hours that room setback raises heat pump demand: %.0f%%",</span>
<span class="source-line-no">157</span><span id="line-157">                                                100f * result201X.hoursFractionSetbackRaisesDemand()));</span>
<span class="source-line-no">158</span><span id="line-158">                                        }</span>
<span class="source-line-no">159</span><span id="line-159">                                }</span>
<span class="source-line-no">160</span><span id="line-160">                        }</span>
<span class="source-line-no">161</span><span id="line-161"></span>
<span class="source-line-no">162</span><span id="line-162"></span>
<span class="source-line-no">163</span><span id="line-163">        // Pure weather-compensated comparison.</span>
<span class="source-line-no">164</span><span id="line-164">        System.out.println("");</span>
<span class="source-line-no">165</span><span id="line-165">        for(final boolean bungalow : new boolean[] {true, false})</span>
<span class="source-line-no">166</span><span id="line-166">                {</span>
<span class="source-line-no">167</span><span id="line-167">                final String archetype = bungalow ? "bungalow" : "detached";</span>
<span class="source-line-no">168</span><span id="line-168"></span>
<span class="source-line-no">169</span><span id="line-169">                System.out.println(String.format("Original conditions, %s demand, with 'stiff' A-room temperature regulation:", archetype));</span>
<span class="source-line-no">170</span><span id="line-170">                final DemandWithoutAndWithSetback originalBungalowDemand = HGTRVHPMModelParameterised.computeDetachedDemandW(HGTRVHPMModelParameterised.ModelParameters.FIXES_APPLIED, bungalow);</span>
<span class="source-line-no">171</span><span id="line-171">                final double heatNoSetbackBungalowStiff = originalBungalowDemand.noSetback().heatDemand();</span>
<span class="source-line-no">172</span><span id="line-172">                final double heatWithSetbackBungalowStiff = originalBungalowDemand.withSetback().heatDemand();</span>
<span class="source-line-no">173</span><span id="line-173">                System.out.println(String.format("  Heat mean demand: with no setback %.0fW, with setback %.0fW; %.0f%% change with setback",</span>
<span class="source-line-no">174</span><span id="line-174">                                heatNoSetbackBungalowStiff, heatWithSetbackBungalowStiff, 100*((heatWithSetbackBungalowStiff/heatNoSetbackBungalowStiff)-1)));</span>
<span class="source-line-no">175</span><span id="line-175">                final double powerNoSetbackBungalowStiff = originalBungalowDemand.noSetback().heatPumpElectricity();</span>
<span class="source-line-no">176</span><span id="line-176">                final double powerWithSetbackBungalowStiff = originalBungalowDemand.withSetback().heatPumpElectricity();</span>
<span class="source-line-no">177</span><span id="line-177">                System.out.println(String.format("  Heat pump mean power: with no setback %.0fW, with setback %.0fW; %.0f%% change with setback",</span>
<span class="source-line-no">178</span><span id="line-178">                                powerNoSetbackBungalowStiff, powerWithSetbackBungalowStiff, 100*((powerWithSetbackBungalowStiff/powerNoSetbackBungalowStiff)-1)));</span>
<span class="source-line-no">179</span><span id="line-179"></span>
<span class="source-line-no">180</span><span id="line-180">                final double equilibriumTemperatureSoftBungalow[] = new double[1];</span>
<span class="source-line-no">181</span><span id="line-181">                final DemandWithoutAndWithSetback softBungalowDemand = HGTRVHPMModelParameterised.computeSoftATempDemandW(HGTRVHPMModelParameterised.ModelParameters.FIXES_APPLIED, bungalow, equilibriumTemperatureSoftBungalow);</span>
<span class="source-line-no">182</span><span id="line-182">                System.out.println(String.format("Original conditions, %s demand, with 'soft' A-room temperature regulation at %.1fC:", archetype, equilibriumTemperatureSoftBungalow[0]));</span>
<span class="source-line-no">183</span><span id="line-183">                final double heatNoSetbackBungalowSoft = softBungalowDemand.noSetback().heatDemand();</span>
<span class="source-line-no">184</span><span id="line-184">                final double heatWithSetbackBungalowSoft = softBungalowDemand.withSetback().heatDemand();</span>
<span class="source-line-no">185</span><span id="line-185">                System.out.println(String.format("  Heat mean demand: with no setback %.0fW, with setback %.0fW; %.0f%% change with setback",</span>
<span class="source-line-no">186</span><span id="line-186">                                heatNoSetbackBungalowSoft, heatWithSetbackBungalowSoft, 100*((heatWithSetbackBungalowSoft/heatNoSetbackBungalowSoft)-1)));</span>
<span class="source-line-no">187</span><span id="line-187">                final double powerNoSetbackBungalowSoft = softBungalowDemand.noSetback().heatPumpElectricity();</span>
<span class="source-line-no">188</span><span id="line-188">                final double powerWithSetbackBungalowSoft = softBungalowDemand.withSetback().heatPumpElectricity();</span>
<span class="source-line-no">189</span><span id="line-189">                System.out.println(String.format("  Heat pump mean power: with no setback %.0fW, with setback %.0fW; %.0f%% change with setback",</span>
<span class="source-line-no">190</span><span id="line-190">                                powerNoSetbackBungalowSoft, powerWithSetbackBungalowSoft, 100*((powerWithSetbackBungalowSoft/powerNoSetbackBungalowSoft)-1)));</span>
<span class="source-line-no">191</span><span id="line-191">                }</span>
<span class="source-line-no">192</span><span id="line-192"></span>
<span class="source-line-no">193</span><span id="line-193"></span>
<span class="source-line-no">194</span><span id="line-194">        System.out.println("");</span>
<span class="source-line-no">195</span><span id="line-195">        System.out.println("Parameterised model, bungalow, soft regulation, fixes applied for doors and CoP temperature, external air temperature varied...");</span>
<span class="source-line-no">196</span><span id="line-196">        System.out.println("London (EGLL) 2018 hourly temperatures");</span>
<span class="source-line-no">197</span><span id="line-197">                for(final boolean abab : new boolean[]{true, false})</span>
<span class="source-line-no">198</span><span id="line-198">                        {</span>
<span class="source-line-no">199</span><span id="line-199">                final String layout = abab ? "ABAB" : "AABB";</span>
<span class="source-line-no">200</span><span id="line-200">                        System.out.println("Layout " + layout);</span>
<span class="source-line-no">201</span><span id="line-201">                final HGTRVHPMModelParameterised.ModelParameters modelParameters = new HGTRVHPMModelParameterised.ModelParameters(</span>
<span class="source-line-no">202</span><span id="line-202">                                        ModelParameters.FIXED_DOORS_PER_INTERNAL_WALL,</span>
<span class="source-line-no">203</span><span id="line-203">                                        ModelParameters.FIXED_CORRECT_COP_FOR_FLOW_TEMPERATURE,</span>
<span class="source-line-no">204</span><span id="line-204">                                        abab,</span>
<span class="source-line-no">205</span><span id="line-205">                                        ModelParameters.DEFAULT_EXTERNAL_AIR_TEMPERATURE_C);</span>
<span class="source-line-no">206</span><span id="line-206">                final double equilibriumTemperatureMinLondon2018Soft[] = new double[1];</span>
<span class="source-line-no">207</span><span id="line-207">                final DDNTemperatureDataCSV temperaturesLondon2018Soft =</span>
<span class="source-line-no">208</span><span id="line-208">                                DDNTemperatureDataCSV.loadDDNTemperatureDataCSV(DDNTemperatureDataCSV.DATA_EGLL_2018);</span>
<span class="source-line-no">209</span><span id="line-209">                final HGTRVHPMModelByHour scenarioLondon2018Soft = new HGTRVHPMModelByHour(</span>
<span class="source-line-no">210</span><span id="line-210">                                modelParameters, temperaturesLondon2018Soft);</span>
<span class="source-line-no">211</span><span id="line-211">                final ScenarioResult resultLondon2018Soft = scenarioLondon2018Soft.runScenario(false, true, equilibriumTemperatureMinLondon2018Soft);</span>
<span class="source-line-no">212</span><span id="line-212">                System.out.println(String.format("  Minimum A-room temperature %.1fC", equilibriumTemperatureMinLondon2018Soft[0]));</span>
<span class="source-line-no">213</span><span id="line-213">                System.out.println(String.format("  Percentage of hours that room setback raises heat pump demand: %.1f%%",</span>
<span class="source-line-no">214</span><span id="line-214">                                100 * resultLondon2018Soft.hoursFractionSetbackRaisesDemand()));</span>
<span class="source-line-no">215</span><span id="line-215">                final double heatNoSetbackLondon2018Soft = resultLondon2018Soft.demand().noSetback().heatDemand();</span>
<span class="source-line-no">216</span><span id="line-216">                final double heatWithSetbackLondon2018Soft = resultLondon2018Soft.demand().withSetback().heatDemand();</span>
<span class="source-line-no">217</span><span id="line-217">                System.out.println(String.format("  Heat mean demand: with no setback %.0fW, with setback %.0fW; %.1f%% change with setback",</span>
<span class="source-line-no">218</span><span id="line-218">                                heatNoSetbackLondon2018Soft, heatWithSetbackLondon2018Soft, 100*((heatWithSetbackLondon2018Soft/heatNoSetbackLondon2018Soft)-1)));</span>
<span class="source-line-no">219</span><span id="line-219">                final double powerNoSetbackLondon2018Soft = resultLondon2018Soft.demand().noSetback().heatPumpElectricity();</span>
<span class="source-line-no">220</span><span id="line-220">                final double powerWithSetbackLondon2018Soft = resultLondon2018Soft.demand().withSetback().heatPumpElectricity();</span>
<span class="source-line-no">221</span><span id="line-221">                System.out.println(String.format("  Heat pump mean power: with no setback %.0fW, with setback %.0fW; %.1f%% change with setback",</span>
<span class="source-line-no">222</span><span id="line-222">                                powerNoSetbackLondon2018Soft, powerWithSetbackLondon2018Soft, 100*((powerWithSetbackLondon2018Soft/powerNoSetbackLondon2018Soft)-1)));</span>
<span class="source-line-no">223</span><span id="line-223">                        }</span>
<span class="source-line-no">224</span><span id="line-224"></span>
<span class="source-line-no">225</span><span id="line-225"></span>
<span class="source-line-no">226</span><span id="line-226">        System.out.println();</span>
<span class="source-line-no">227</span><span id="line-227">        System.out.println("Parameterised model, bungalow, soft A temperature regulation, fixes applied for doors and CoP temperature, external air temperature varied...");</span>
<span class="source-line-no">228</span><span id="line-228">        for(double eat = HGTRVHPMModel.EXTERNAL_AIR_TEMPERATURE_C - 10.0; eat &lt; HGTRVHPMModel.SETBACK_ROOM_TEMPERATURE_C; eat += 1.0)</span>
<span class="source-line-no">229</span><span id="line-229">                {</span>
<span class="source-line-no">230</span><span id="line-230">                final HGTRVHPMModelParameterised.ModelParameters params = new ModelParameters(</span>
<span class="source-line-no">231</span><span id="line-231">                                ModelParameters.FIXED_DOORS_PER_INTERNAL_WALL,</span>
<span class="source-line-no">232</span><span id="line-232">                                ModelParameters.FIXED_CORRECT_COP_FOR_FLOW_TEMPERATURE,</span>
<span class="source-line-no">233</span><span id="line-233">                                ModelParameters.DEFAULT_ARRANGEMENT_ABAB,</span>
<span class="source-line-no">234</span><span id="line-234">                                eat);</span>
<span class="source-line-no">235</span><span id="line-235">                if(Math.abs(HGTRVHPMModel.EXTERNAL_AIR_TEMPERATURE_C - eat) &lt; 0.1)</span>
<span class="source-line-no">236</span><span id="line-236">                        {</span>
<span class="source-line-no">237</span><span id="line-237">                        System.out.println(String.format(" *** original external air temperature, ie %.1fC", eat));</span>
<span class="source-line-no">238</span><span id="line-238">                        }</span>
<span class="source-line-no">239</span><span id="line-239">                final double equilibriumTemperature[] = new double[1];</span>
<span class="source-line-no">240</span><span id="line-240">                HGTRVHPMModelParameterised.computeSoftATempDemandW(params, true, equilibriumTemperature);</span>
<span class="source-line-no">241</span><span id="line-241">                final double sag = HGTRVHPMModel.NORMAL_ROOM_TEMPERATURE_C - equilibriumTemperature[0];</span>
<span class="source-line-no">242</span><span id="line-242">                System.out.println(String.format("  temperature sag %.1fK @ %.1fC",</span>
<span class="source-line-no">243</span><span id="line-243">                                sag, eat));</span>
<span class="source-line-no">244</span><span id="line-244">                }</span>
<span class="source-line-no">245</span><span id="line-245">                }</span>
<span class="source-line-no">246</span><span id="line-246"></span>
<span class="source-line-no">247</span><span id="line-247"></span>
<span class="source-line-no">248</span><span id="line-248">        /**Generate the main summary model results table for 7 places, 10 years, in (X)HTML5; non-null.</span>
<span class="source-line-no">249</span><span id="line-249">         * Attempts to remain at least slightly human readable.</span>
<span class="source-line-no">250</span><span id="line-250">         * &lt;p&gt;</span>
<span class="source-line-no">251</span><span id="line-251">         * The table class at least should be fixed up manually.</span>
<span class="source-line-no">252</span><span id="line-252">         *</span>
<span class="source-line-no">253</span><span id="line-253">         * @param stiff  if true then in stiff (load comp) regulation mode, else soft (weather comp)</span>
<span class="source-line-no">254</span><span id="line-254">         * @return HTML table summary; non-empty, non-null</span>
<span class="source-line-no">255</span><span id="line-255">         * @throws IOException in case of missing or corrupt temperature data</span>
<span class="source-line-no">256</span><span id="line-256">         */</span>
<span class="source-line-no">257</span><span id="line-257">        public static String generateHTMLMainSummaryTable(final boolean stiff) throws IOException</span>
<span class="source-line-no">258</span><span id="line-258">                {</span>
<span class="source-line-no">259</span><span id="line-259">                // Vertically split as location, heat demand delta on setback, ABAB hp demand change, AABB demand change.</span>
<span class="source-line-no">260</span><span id="line-260">                // Each by bungalow/detached.</span>
<span class="source-line-no">261</span><span id="line-261">                final StringBuilder result = new StringBuilder();</span>
<span class="source-line-no">262</span><span id="line-262">                result.append("&lt;table style=\"border:1px solid\" class=\"yourTableStyle\"&gt;\n");</span>
<span class="source-line-no">263</span><span id="line-263">                result.append(String.format("""</span>
<span class="source-line-no">264</span><span id="line-264">                        &lt;caption&gt;\</span>
<span class="source-line-no">265</span><span id="line-265">                        %s mode: summary of mean power change with selected-room setback of\s\</span>
<span class="source-line-no">266</span><span id="line-266">                        (1) %s temperature regulation in A rooms\s\</span>
<span class="source-line-no">267</span><span id="line-267">                        (2) whole-home heat demand and of\s\</span>
<span class="source-line-no">268</span><span id="line-268">                        (3) heat-pump electrical demand in high ABAB and low AABB internal loss room setback arrangements\s\</span>
<span class="source-line-no">269</span><span id="line-269">                        (4) for 1- and 2- storey (bungalow and detached) archetypes, \s\</span>
<span class="source-line-no">270</span><span id="line-270">                        for %d UK locations.\s\</span>
<span class="source-line-no">271</span><span id="line-271">                        Based on hourly temperature data for the ten years 201X.\s\</span>
<span class="source-line-no">272</span><span id="line-272">                        When B rooms are set back overall home heat demand does fall,\s\</span>
<span class="source-line-no">273</span><span id="line-273">                        but in the ABAB layout that maximises internal losses,\s\</span>
<span class="source-line-no">274</span><span id="line-274">                        heat-pump electricity demand rises, in all scenarios,\s\</span>
<span class="source-line-no">275</span><span id="line-275">                        especially in the detached house cases.\</span>
<span class="source-line-no">276</span><span id="line-276">                        &lt;/caption&gt;</span>
<span class="source-line-no">277</span><span id="line-277">                        """,</span>
<span class="source-line-no">278</span><span id="line-278">                            stiff ? "Stiff" : "Soft",</span>
<span class="source-line-no">279</span><span id="line-279">                            stiff ? "stiff" : "soft",</span>
<span class="source-line-no">280</span><span id="line-280">                                DDNTemperatureDataCSV.DESCRIPTORS_201X_DATASET.size()));</span>
<span class="source-line-no">281</span><span id="line-281">                result.append("""</span>
<span class="source-line-no">282</span><span id="line-282">                        &lt;thead&gt;&lt;tr&gt;\</span>
<span class="source-line-no">283</span><span id="line-283">                        &lt;th&gt;Location (Weather Station)&lt;/th&gt;\</span>
<span class="source-line-no">284</span><span id="line-284">                        &lt;th&gt;Archetype&lt;/th&gt;\</span>
<span class="source-line-no">285</span><span id="line-285">                        &lt;th&gt;Home heat demand delta&lt;/th&gt;\</span>
<span class="source-line-no">286</span><span id="line-286">                        &lt;th&gt;ABAB heat-pump demand delta&lt;/th&gt;\</span>
<span class="source-line-no">287</span><span id="line-287">                        &lt;th&gt;AABB heat-pump demand delta&lt;/th&gt;\</span>
<span class="source-line-no">288</span><span id="line-288">                        &lt;/tr&gt;&lt;/thead&gt;</span>
<span class="source-line-no">289</span><span id="line-289">                        """);</span>
<span class="source-line-no">290</span><span id="line-290"></span>
<span class="source-line-no">291</span><span id="line-291">                result.append("&lt;tbody&gt;\n");</span>
<span class="source-line-no">292</span><span id="line-292">                for(final HourlyTemperatureDataDescriptor htdd : DDNTemperatureDataCSV.DESCRIPTORS_201X_DATASET)</span>
<span class="source-line-no">293</span><span id="line-293">                        {</span>
<span class="source-line-no">294</span><span id="line-294">                // Load temperature data for this station.</span>
<span class="source-line-no">295</span><span id="line-295">                        final DDNTemperatureDataCSV temperatures201X =</span>
<span class="source-line-no">296</span><span id="line-296">                                DDNTemperatureDataCSV.loadDDNTemperatureDataCSV(new File(DDNTemperatureDataCSV.PATH_TO_201X_TEMPERATURE_DATA,</span>
<span class="source-line-no">297</span><span id="line-297">                                        htdd.station() + DDNTemperatureDataCSV.FILE_TAIL_FOR_201X_TEMPERATURE_FILE));</span>
<span class="source-line-no">298</span><span id="line-298">                if(DDNTemperatureDataCSV.RECORD_COUNT_201X_TEMPERATURE_DATA != temperatures201X.data().size())</span>
<span class="source-line-no">299</span><span id="line-299">                        { throw new IOException("bad record count"); }</span>
<span class="source-line-no">300</span><span id="line-300">                        for(final boolean detached : new boolean[]{false, true})</span>
<span class="source-line-no">301</span><span id="line-301">                                {</span>
<span class="source-line-no">302</span><span id="line-302">                                result.append("&lt;tr&gt;");</span>
<span class="source-line-no">303</span><span id="line-303">                                if(!detached)</span>
<span class="source-line-no">304</span><span id="line-304">                                    { result.append(String.format("&lt;td rowspan=\"2\"&gt;%s (%s)&lt;/td&gt;", htdd.conurbation(), htdd.station())); }</span>
<span class="source-line-no">305</span><span id="line-305"></span>
<span class="source-line-no">306</span><span id="line-306">                        final String archetype = detached ? "detached" : "bungalow";</span>
<span class="source-line-no">307</span><span id="line-307">                        result.append(String.format("&lt;td&gt;%s&lt;/td&gt;", archetype));</span>
<span class="source-line-no">308</span><span id="line-308">                                for(final boolean abab : new boolean[]{true, false})</span>
<span class="source-line-no">309</span><span id="line-309">                                        {</span>
<span class="source-line-no">310</span><span id="line-310">                                final HGTRVHPMModelParameterised.ModelParameters modelParameters = new HGTRVHPMModelParameterised.ModelParameters(</span>
<span class="source-line-no">311</span><span id="line-311">                                                        ModelParameters.FIXED_DOORS_PER_INTERNAL_WALL,</span>
<span class="source-line-no">312</span><span id="line-312">                                                        ModelParameters.FIXED_CORRECT_COP_FOR_FLOW_TEMPERATURE,</span>
<span class="source-line-no">313</span><span id="line-313">                                                        abab,</span>
<span class="source-line-no">314</span><span id="line-314">                                                        ModelParameters.DEFAULT_EXTERNAL_AIR_TEMPERATURE_C);</span>
<span class="source-line-no">315</span><span id="line-315">                                        final HGTRVHPMModelByHour scenario201X = new HGTRVHPMModelByHour(</span>
<span class="source-line-no">316</span><span id="line-316">                                        modelParameters,</span>
<span class="source-line-no">317</span><span id="line-317">                                        temperatures201X);</span>
<span class="source-line-no">318</span><span id="line-318">                                final ScenarioResult result201X = scenario201X.runScenario(detached, !stiff, null);</span>
<span class="source-line-no">319</span><span id="line-319">                                final double heatNoSetback201X = result201X.demand().noSetback().heatDemand();</span>
<span class="source-line-no">320</span><span id="line-320">                                final double heatWithSetback201X = result201X.demand().withSetback().heatDemand();</span>
<span class="source-line-no">321</span><span id="line-321">                                // Overall home heat demand is not affected by archetype or room setback layout, so only show once.</span>
<span class="source-line-no">322</span><span id="line-322">                                final double heatDelta201X = 100*((heatWithSetback201X/heatNoSetback201X)-1);</span>
<span class="source-line-no">323</span><span id="line-323">                                if(!detached &amp;&amp; abab)</span>
<span class="source-line-no">324</span><span id="line-324">                                    { result.append(String.format("&lt;td rowspan=\"2\" style=\"text-align:right\"&gt;%.1f%%&lt;/td&gt;", heatDelta201X)); }</span>
<span class="source-line-no">325</span><span id="line-325">                                // Heat-pump power demand delta.</span>
<span class="source-line-no">326</span><span id="line-326">                                final double powerNoSetback201X = result201X.demand().noSetback().heatPumpElectricity();</span>
<span class="source-line-no">327</span><span id="line-327">                                final double powerWithSetback201X = result201X.demand().withSetback().heatPumpElectricity();</span>
<span class="source-line-no">328</span><span id="line-328">                                final double powerDelta201X = 100*((powerWithSetback201X/powerNoSetback201X)-1);</span>
<span class="source-line-no">329</span><span id="line-329">                                result.append(String.format("&lt;td style=\"text-align:right\"&gt;%.1f%%&lt;/td&gt;", powerDelta201X));</span>
<span class="source-line-no">330</span><span id="line-330">                                        }</span>
<span class="source-line-no">331</span><span id="line-331">                                result.append("&lt;/tr&gt;\n");</span>
<span class="source-line-no">332</span><span id="line-332">                                }</span>
<span class="source-line-no">333</span><span id="line-333">                        }</span>
<span class="source-line-no">334</span><span id="line-334">                result.append("&lt;/tbody&gt;\n");</span>
<span class="source-line-no">335</span><span id="line-335">                result.append("&lt;/table&gt;");</span>
<span class="source-line-no">336</span><span id="line-336">                return(result.toString());</span>
<span class="source-line-no">337</span><span id="line-337">                }</span>
<span class="source-line-no">338</span><span id="line-338"></span>
<span class="source-line-no">339</span><span id="line-339">        /**Generate the main summary model results table for 7 places, 10 years, in LaTeX; non-null.</span>
<span class="source-line-no">340</span><span id="line-340">         * Attempts to remain at least slightly human readable.</span>
<span class="source-line-no">341</span><span id="line-341">         * &lt;p&gt;</span>
<span class="source-line-no">342</span><span id="line-342">         * Some details may need to be fixed up manually, including the label.</span>
<span class="source-line-no">343</span><span id="line-343">         *</span>
<span class="source-line-no">344</span><span id="line-344">         * @param stiff  if true then in stiff (load comp) regulation mode, else soft (weather comp)</span>
<span class="source-line-no">345</span><span id="line-345">         * @return LaTeX table summary; non-null, non-empty</span>
<span class="source-line-no">346</span><span id="line-346">         * @throws IOException in case of missing or corrupt temperature data</span>
<span class="source-line-no">347</span><span id="line-347">         */</span>
<span class="source-line-no">348</span><span id="line-348">        public static String generateLaTeXMainSummaryTable(final boolean stiff) throws IOException</span>
<span class="source-line-no">349</span><span id="line-349">                {</span>
<span class="source-line-no">350</span><span id="line-350">                final StringBuilder result = new StringBuilder();</span>
<span class="source-line-no">351</span><span id="line-351">                result.append("\\begin{table}[H]\n");</span>
<span class="source-line-no">352</span><span id="line-352">            result.append(String.format("""</span>
<span class="source-line-no">353</span><span id="line-353">                \\caption{\</span>
<span class="source-line-no">354</span><span id="line-354">                        %s mode: summary of mean power change with selected-room setback of\s\</span>
<span class="source-line-no">355</span><span id="line-355">                        (1) %s temperature regulation in A rooms\s\</span>
<span class="source-line-no">356</span><span id="line-356">                        (2) whole-home heat demand and of\s\</span>
<span class="source-line-no">357</span><span id="line-357">                        (3) heat-pump electrical demand in high ABAB and low AABB internal loss room setback arrangements\s\</span>
<span class="source-line-no">358</span><span id="line-358">                        (4) for 1- and 2- storey (bungalow and detached) archetypes, \s\</span>
<span class="source-line-no">359</span><span id="line-359">                        for %d UK locations.\s\</span>
<span class="source-line-no">360</span><span id="line-360">                        Based on hourly temperature data for the ten years 201X.\s\</span>
<span class="source-line-no">361</span><span id="line-361">                        When B rooms are set back overall home heat demand does fall,\s\</span>
<span class="source-line-no">362</span><span id="line-362">                        but in the ABAB layout that maximises internal losses,\s\</span>
<span class="source-line-no">363</span><span id="line-363">                        heat-pump electricity demand rises, in all scenarios,\s\</span>
<span class="source-line-no">364</span><span id="line-364">                        especially in the detached house cases.\</span>
<span class="source-line-no">365</span><span id="line-365">                        \\label{t-summary}}\</span>
<span class="source-line-no">366</span><span id="line-366">                        """,</span>
<span class="source-line-no">367</span><span id="line-367">                            stiff ? "Stiff" : "Soft",</span>
<span class="source-line-no">368</span><span id="line-368">                            stiff ? "stiff" : "soft",</span>
<span class="source-line-no">369</span><span id="line-369">                                DDNTemperatureDataCSV.DESCRIPTORS_201X_DATASET.size()));</span>
<span class="source-line-no">370</span><span id="line-370">        result.append("\\begin{adjustwidth}{-\\extralength}{0cm}\n"</span>
<span class="source-line-no">371</span><span id="line-371">                        + "                \\newcolumntype{C}{&gt;{\\centering\\arraybackslash}X}\n"</span>
<span class="source-line-no">372</span><span id="line-372">                        + "                \\begin{tabularx}{\\fulllength}{CCCCC}\n"</span>
<span class="source-line-no">373</span><span id="line-373">                        + "                        \\toprule\n"</span>
<span class="source-line-no">374</span><span id="line-374">                        + "");</span>
<span class="source-line-no">375</span><span id="line-375">        result.append(""</span>
<span class="source-line-no">376</span><span id="line-376">                        + "\\textbf{Location (Weather Station)} &amp; "</span>
<span class="source-line-no">377</span><span id="line-377">                        + "\\textbf{Archetype} &amp; "</span>
<span class="source-line-no">378</span><span id="line-378">                        + "\\textbf{Home heat demand delta} &amp; "</span>
<span class="source-line-no">379</span><span id="line-379">                        + "\\textbf{ABAB heat-pump demand delta} &amp; "</span>
<span class="source-line-no">380</span><span id="line-380">                        + "\\textbf{AABB heat-pump demand delta}"</span>
<span class="source-line-no">381</span><span id="line-381">                        + "\\\\\n"</span>
<span class="source-line-no">382</span><span id="line-382">                        + "");</span>
<span class="source-line-no">383</span><span id="line-383"></span>
<span class="source-line-no">384</span><span id="line-384">                for(final HourlyTemperatureDataDescriptor htdd : DDNTemperatureDataCSV.DESCRIPTORS_201X_DATASET)</span>
<span class="source-line-no">385</span><span id="line-385">                        {</span>
<span class="source-line-no">386</span><span id="line-386">                // Load temperature data for this station.</span>
<span class="source-line-no">387</span><span id="line-387">                        final DDNTemperatureDataCSV temperatures201X =</span>
<span class="source-line-no">388</span><span id="line-388">                                DDNTemperatureDataCSV.loadDDNTemperatureDataCSV(new File(DDNTemperatureDataCSV.PATH_TO_201X_TEMPERATURE_DATA,</span>
<span class="source-line-no">389</span><span id="line-389">                                        htdd.station() + DDNTemperatureDataCSV.FILE_TAIL_FOR_201X_TEMPERATURE_FILE));</span>
<span class="source-line-no">390</span><span id="line-390">                if(DDNTemperatureDataCSV.RECORD_COUNT_201X_TEMPERATURE_DATA != temperatures201X.data().size())</span>
<span class="source-line-no">391</span><span id="line-391">                        { throw new IOException("bad record count"); }</span>
<span class="source-line-no">392</span><span id="line-392">                        for(final boolean detached : new boolean[]{false, true})</span>
<span class="source-line-no">393</span><span id="line-393">                                {</span>
<span class="source-line-no">394</span><span id="line-394">                                if(!detached)</span>
<span class="source-line-no">395</span><span id="line-395">                                    { result.append(String.format("\\midrule\\multirow[m]{2}{*}{%s (%s)}", htdd.conurbation(), htdd.station())); }</span>
<span class="source-line-no">396</span><span id="line-396">                                result.append(" &amp; ");</span>
<span class="source-line-no">397</span><span id="line-397"></span>
<span class="source-line-no">398</span><span id="line-398">                        final String archetype = detached ? "detached" : "bungalow";</span>
<span class="source-line-no">399</span><span id="line-399">                        result.append(String.format("%s &amp; ", archetype));</span>
<span class="source-line-no">400</span><span id="line-400">                                for(final boolean abab : new boolean[]{true, false})</span>
<span class="source-line-no">401</span><span id="line-401">                                        {</span>
<span class="source-line-no">402</span><span id="line-402">                                final HGTRVHPMModelParameterised.ModelParameters modelParameters = new HGTRVHPMModelParameterised.ModelParameters(</span>
<span class="source-line-no">403</span><span id="line-403">                                                        ModelParameters.FIXED_DOORS_PER_INTERNAL_WALL,</span>
<span class="source-line-no">404</span><span id="line-404">                                                        ModelParameters.FIXED_CORRECT_COP_FOR_FLOW_TEMPERATURE,</span>
<span class="source-line-no">405</span><span id="line-405">                                                        abab,</span>
<span class="source-line-no">406</span><span id="line-406">                                                        ModelParameters.DEFAULT_EXTERNAL_AIR_TEMPERATURE_C);</span>
<span class="source-line-no">407</span><span id="line-407">                                        final HGTRVHPMModelByHour scenario201X = new HGTRVHPMModelByHour(</span>
<span class="source-line-no">408</span><span id="line-408">                                        modelParameters,</span>
<span class="source-line-no">409</span><span id="line-409">                                        temperatures201X);</span>
<span class="source-line-no">410</span><span id="line-410">                                final ScenarioResult result201X = scenario201X.runScenario(detached, !stiff, null);</span>
<span class="source-line-no">411</span><span id="line-411">                                final double heatNoSetback201X = result201X.demand().noSetback().heatDemand();</span>
<span class="source-line-no">412</span><span id="line-412">                                final double heatWithSetback201X = result201X.demand().withSetback().heatDemand();</span>
<span class="source-line-no">413</span><span id="line-413">                                // Overall home heat demand is not affected by archetype or room setback layout, so only show once.</span>
<span class="source-line-no">414</span><span id="line-414">                                final double heatDelta201X = 100*((heatWithSetback201X/heatNoSetback201X)-1);</span>
<span class="source-line-no">415</span><span id="line-415">                                if(!detached &amp;&amp; abab)</span>
<span class="source-line-no">416</span><span id="line-416">                                    { result.append(String.format("\\multirow[m]{2}{*}{%.1f\\%%}", heatDelta201X)); }</span>
<span class="source-line-no">417</span><span id="line-417">                                        result.append(" &amp; ");</span>
<span class="source-line-no">418</span><span id="line-418">                                // Heat-pump power demand delta.</span>
<span class="source-line-no">419</span><span id="line-419">                                final double powerNoSetback201X = result201X.demand().noSetback().heatPumpElectricity();</span>
<span class="source-line-no">420</span><span id="line-420">                                final double powerWithSetback201X = result201X.demand().withSetback().heatPumpElectricity();</span>
<span class="source-line-no">421</span><span id="line-421">                                final double powerDelta201X = 100*((powerWithSetback201X/powerNoSetback201X)-1);</span>
<span class="source-line-no">422</span><span id="line-422">                                result.append(String.format("%.1f\\%% ", powerDelta201X));</span>
<span class="source-line-no">423</span><span id="line-423">                                        }</span>
<span class="source-line-no">424</span><span id="line-424">                                result.append("\\\\\n");</span>
<span class="source-line-no">425</span><span id="line-425">                                }</span>
<span class="source-line-no">426</span><span id="line-426">                        }</span>
<span class="source-line-no">427</span><span id="line-427"></span>
<span class="source-line-no">428</span><span id="line-428">        result.append("                        \\bottomrule\n"</span>
<span class="source-line-no">429</span><span id="line-429">                        + "                \\end{tabularx}\n"</span>
<span class="source-line-no">430</span><span id="line-430">                        + "        \\end{adjustwidth}\n"</span>
<span class="source-line-no">431</span><span id="line-431">                        + "");</span>
<span class="source-line-no">432</span><span id="line-432">                result.append("\\end{table}");</span>
<span class="source-line-no">433</span><span id="line-433">                return(result.toString());</span>
<span class="source-line-no">434</span><span id="line-434">                }</span>
<span class="source-line-no">435</span><span id="line-435"></span>
<span class="source-line-no">436</span><span id="line-436"></span>
<span class="source-line-no">437</span><span id="line-437">        /**Generate the temperature sag model results table for 7 places, 10 years, in (X)HTML5; non-null.</span>
<span class="source-line-no">438</span><span id="line-438">         * Attempts to remain at least slightly human readable.</span>
<span class="source-line-no">439</span><span id="line-439">         * &lt;p&gt;</span>
<span class="source-line-no">440</span><span id="line-440">         * The table class at least should be fixed up manually.</span>
<span class="source-line-no">441</span><span id="line-441">         *</span>
<span class="source-line-no">442</span><span id="line-442">         * @return HTML table for sag data; non-null, non-empty</span>
<span class="source-line-no">443</span><span id="line-443">         * @throws IOException in case of missing or corrupt temperature data</span>
<span class="source-line-no">444</span><span id="line-444">         */</span>
<span class="source-line-no">445</span><span id="line-445">        public static String generateHTMLSagTable() throws IOException</span>
<span class="source-line-no">446</span><span id="line-446">                {</span>
<span class="source-line-no">447</span><span id="line-447">                // Vertically split as location, ABAB sag, AABB sag.</span>
<span class="source-line-no">448</span><span id="line-448">                // Each by bungalow/detached.</span>
<span class="source-line-no">449</span><span id="line-449">                final StringBuilder result = new StringBuilder();</span>
<span class="source-line-no">450</span><span id="line-450">                result.append("&lt;table style=\"border:1px solid\" class=\"yourTableStyle\"&gt;\n");</span>
<span class="source-line-no">451</span><span id="line-451">                result.append(String.format("""</span>
<span class="source-line-no">452</span><span id="line-452">                        &lt;caption&gt;\</span>
<span class="source-line-no">453</span><span id="line-453">                        Soft mode: summary of maximum A-room temperature sag with selected-room setback of\s\</span>
<span class="source-line-no">454</span><span id="line-454">                        (1) soft temperature regulation in A rooms\s\</span>
<span class="source-line-no">455</span><span id="line-455">                        (2) maximum (ie worst-case) temperature dip in high ABAB and low AABB internal loss room setback arrangements\s\</span>
<span class="source-line-no">456</span><span id="line-456">                        (4) for 1- and 2- storey (bungalow and detached) archetypes, \s\</span>
<span class="source-line-no">457</span><span id="line-457">                        for %d UK locations.\s\</span>
<span class="source-line-no">458</span><span id="line-458">                        Based on hourly temperature data for the ten years 201X.\s\</span>
<span class="source-line-no">459</span><span id="line-459">                        When B rooms are set back with soft-mode regulation overall home heat demand and heat-pump does fall,\s\</span>
<span class="source-line-no">460</span><span id="line-460">                        and the maximum temperature sag in A rooms is shown.\</span>
<span class="source-line-no">461</span><span id="line-461">                        &lt;/caption&gt;</span>
<span class="source-line-no">462</span><span id="line-462">                        """,</span>
<span class="source-line-no">463</span><span id="line-463">                                DDNTemperatureDataCSV.DESCRIPTORS_201X_DATASET.size()));</span>
<span class="source-line-no">464</span><span id="line-464">                result.append("""</span>
<span class="source-line-no">465</span><span id="line-465">                        &lt;thead&gt;&lt;tr&gt;\</span>
<span class="source-line-no">466</span><span id="line-466">                        &lt;th&gt;Location (Weather Station)&lt;/th&gt;&lt;th&gt;Archetype&lt;/th&gt;\</span>
<span class="source-line-no">467</span><span id="line-467">                        &lt;th&gt;ABAB worst-case sag&lt;/th&gt;\</span>
<span class="source-line-no">468</span><span id="line-468">                        &lt;th&gt;AABB worst-case sag&lt;/th&gt;\</span>
<span class="source-line-no">469</span><span id="line-469">                        &lt;/tr&gt;&lt;/thead&gt;</span>
<span class="source-line-no">470</span><span id="line-470">                        """);</span>
<span class="source-line-no">471</span><span id="line-471"></span>
<span class="source-line-no">472</span><span id="line-472">                result.append("&lt;tbody&gt;\n");</span>
<span class="source-line-no">473</span><span id="line-473">                for(final HourlyTemperatureDataDescriptor htdd : DDNTemperatureDataCSV.DESCRIPTORS_201X_DATASET)</span>
<span class="source-line-no">474</span><span id="line-474">                        {</span>
<span class="source-line-no">475</span><span id="line-475">                // Load temperature data for this station.</span>
<span class="source-line-no">476</span><span id="line-476">                        final DDNTemperatureDataCSV temperatures201X =</span>
<span class="source-line-no">477</span><span id="line-477">                                DDNTemperatureDataCSV.loadDDNTemperatureDataCSV(new File(DDNTemperatureDataCSV.PATH_TO_201X_TEMPERATURE_DATA,</span>
<span class="source-line-no">478</span><span id="line-478">                                        htdd.station() + DDNTemperatureDataCSV.FILE_TAIL_FOR_201X_TEMPERATURE_FILE));</span>
<span class="source-line-no">479</span><span id="line-479">                if(DDNTemperatureDataCSV.RECORD_COUNT_201X_TEMPERATURE_DATA != temperatures201X.data().size())</span>
<span class="source-line-no">480</span><span id="line-480">                        { throw new IOException("bad record count"); }</span>
<span class="source-line-no">481</span><span id="line-481">                        for(final boolean detached : new boolean[]{false, true})</span>
<span class="source-line-no">482</span><span id="line-482">                                {</span>
<span class="source-line-no">483</span><span id="line-483">                                result.append("&lt;tr&gt;");</span>
<span class="source-line-no">484</span><span id="line-484">                                if(!detached)</span>
<span class="source-line-no">485</span><span id="line-485">                                { result.append(String.format("&lt;td rowspan=\"2\"&gt;%s (%s)&lt;/td&gt;", htdd.conurbation(), htdd.station())); }</span>
<span class="source-line-no">486</span><span id="line-486"></span>
<span class="source-line-no">487</span><span id="line-487">                        final String archetype = detached ? "detached" : "bungalow";</span>
<span class="source-line-no">488</span><span id="line-488">                        result.append(String.format("&lt;td&gt;%s&lt;/td&gt;", archetype));</span>
<span class="source-line-no">489</span><span id="line-489">                                for(final boolean abab : new boolean[]{true, false})</span>
<span class="source-line-no">490</span><span id="line-490">                                        {</span>
<span class="source-line-no">491</span><span id="line-491">                                final String layout = abab ? "ABAB" : "AABB";</span>
<span class="source-line-no">492</span><span id="line-492">                                final HGTRVHPMModelParameterised.ModelParameters modelParameters = new HGTRVHPMModelParameterised.ModelParameters(</span>
<span class="source-line-no">493</span><span id="line-493">                                                        ModelParameters.FIXED_DOORS_PER_INTERNAL_WALL,</span>
<span class="source-line-no">494</span><span id="line-494">                                                        ModelParameters.FIXED_CORRECT_COP_FOR_FLOW_TEMPERATURE,</span>
<span class="source-line-no">495</span><span id="line-495">                                                        abab,</span>
<span class="source-line-no">496</span><span id="line-496">                                                        ModelParameters.DEFAULT_EXTERNAL_AIR_TEMPERATURE_C);</span>
<span class="source-line-no">497</span><span id="line-497">                                        final HGTRVHPMModelByHour scenario201X = new HGTRVHPMModelByHour(</span>
<span class="source-line-no">498</span><span id="line-498">                                        modelParameters,</span>
<span class="source-line-no">499</span><span id="line-499">                                        temperatures201X);</span>
<span class="source-line-no">500</span><span id="line-500">                                        final double equilibriumTemperatureMin[] = new double[1];</span>
<span class="source-line-no">501</span><span id="line-501">                                final ScenarioResult result201X = scenario201X.runScenario(detached, true, equilibriumTemperatureMin);</span>
<span class="source-line-no">502</span><span id="line-502">                                final double sag = HGTRVHPMModel.NORMAL_ROOM_TEMPERATURE_C - equilibriumTemperatureMin[0];</span>
<span class="source-line-no">503</span><span id="line-503">                                result.append(String.format("&lt;td style=\"text-align:right\"&gt;%.1fK&lt;/td&gt;", sag));</span>
<span class="source-line-no">504</span><span id="line-504">                                        }</span>
<span class="source-line-no">505</span><span id="line-505">                                result.append("&lt;/tr&gt;\n");</span>
<span class="source-line-no">506</span><span id="line-506">                                }</span>
<span class="source-line-no">507</span><span id="line-507">                        }</span>
<span class="source-line-no">508</span><span id="line-508">                result.append("&lt;/tbody&gt;\n");</span>
<span class="source-line-no">509</span><span id="line-509">                result.append("&lt;/table&gt;");</span>
<span class="source-line-no">510</span><span id="line-510">                return(result.toString());</span>
<span class="source-line-no">511</span><span id="line-511">                }</span>
<span class="source-line-no">512</span><span id="line-512">        }</span>




























































</pre>
</div>
</main>
</body>
</html>
